<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IoT: VIA_FreeRTOS_ATMEGA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/2.6.8/skins/default.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/2.6.8/wavedrom.min.js" type="text/javascript"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body onload="WaveDrom.ProcessAll()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IoT
   &#160;<span id="projectnumber">v3.2.3 (S2021)</span>
   </div>
   <div id="projectbrief">Engineering in Software Technology</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__free_r_t_o_s_readme.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">VIA_FreeRTOS_ATMEGA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>FreeRTOS for Arduino AVR hardware, but without Arduino code.</p>
<p>It is based on <b>FreeRTOS version 10.4.3</b> and includes the subset that fits the AVR devices.</p>
<p>Based on a Fork of Phillip Stevens FreeRTOS fork optimised for the Arduino AVR devices.</p>
<h2>Project Setup</h2>
<p>Be sure the project you want to add FreeRTOS to is under git control!</p>
<p>Open a command prompt in your projects root folder.</p>
<p>Add this repository in to your project as a git-submodule - by executing this command in the command prompt:</p>
<p><code>git submodule add <a href="https://github.com/ihavn/VIA_FreeRTOS_AVRMEGA">https://github.com/ihavn/VIA_FreeRTOS_AVRMEGA</a> FreeRTOS</code></p>
<p>Add <code>../FreeRTOS/src</code> as a relative include path under the projects <code>Properties-&gt;Toolchain-&gt;AVR/GNU C Compiler-&gt;Directories</code>.</p>
<p>Take a look at the <code>main.c</code>in the <code>Example</code> folder to get started. It is recommended that you create your own <code>main.c</code> in the projects root, and add seperate c modules and header files for each task, and give them meaningful names.</p>
<h2>FreeRTOS Configuration</h2>
<p>Configuration of FreeRTOS must be done in <code>\FreeRTOS\src\FreeRTOSConfig.h</code> see details in the free RTOS documentation. <b>Be sure you know what you are doing before you configure anything!</b></p>
<h2>FreeRTOS Heap Memory</h2>
<p>This repository uses <a class="el" href="heap__4_8c.html">heap_4.c</a> to handle dynamic memory/heap therefore it is <b>required to define how much RAM we will allocate for heap use</b>. This is done by defining <code>#define configTOTAL_HEAP_SIZE 4000</code> in the configuration file <code>\FreeRTOS\src\FreeRTOSConfig.h</code>. In this example it is defined to 4000 bytes.</p>
<h3>R2R Network for trace</h3>
<p>If <code>#define configUseR2RTrace 1</code> then the <code>FreeRTOSTraceDriver</code> is called when a task is switched in and out, and it will send data out to a R2R-network that must be connected to PORTK.</p>
<p>If <code>#define configUseR2RTrace 0</code> then the <code>FreeRTOSTraceDriver</code> will not be used, and can be removed from the project.</p>
<h1>Original Phillip Stevens README</h1>
<p>This is a fork of Richard Barry's freeRTOS, optimised for the Arduino AVR devices.</p>
<p>It has been created to provide access to FreeRTOS capabilities, with full compatibility to the Arduino environment. It does this by keeping hands off almost everything, and only touching the minimum of hardware to be successful.</p>
<p><a href="https://github.com/marketplace/actions/arduino_ci"><img src="https://github.com/feilipu/Arduino_FreeRTOS_Library/workflows/Arduino%20CI/badge.svg" alt="Arduino CI" style="pointer-events: none;" class="inline"/></a></p>
<h1>Usage &amp; Further Reading</h1>
<p>Read the short blog post on <a href="https://feilipu.me/2015/11/24/arduino_freertos/">Arduino FreeRTOS</a> to get started. And there is another much older post on using <a href="https://feilipu.me/2011/09/22/freertos-and-libraries-for-avr-atmega/">FreeRTOS with AVR</a>, which may be useful to read too. There are some further posts I've written on <a href="https://www.hackster.io/feilipu">Hackster.IO</a>, but they're essentially the same content.</p>
<p>The canonical source for information is the <a href="https://www.freertos.org/">FreeRTOS Web Site</a>. Within this site, the <a href="https://www.freertos.org/FreeRTOS-quick-start-guide.html">Getting Started</a> page is very useful. This is the source for FreeRTOS usage (as distinct from installing and using this Arduino Library).</p>
<p>My other <a href="https://sourceforge.net/projects/avrfreertos/">AVRfreeRTOS Sourceforge Repository</a> or <a href="https://github.com/feilipu/avrfreertos">AVRfreeRTOS Github</a> has plenty of examples, ranging from <a href="https://sourceforge.net/projects/avrfreertos/files/MegaBlink/">blink</a> through to a <a href="https://sourceforge.net/projects/avrfreertos/files/GA_Synth/">synthesiser</a>.</p>
<p>This library was the genesis of <a href="https://github.com/FreeRTOS/FreeRTOS-Kernel/pull/48">generalised support for the ATmega platform within FreeRTOS</a>.</p>
<h1>General</h1>
<p>FreeRTOS has a multitude of configuration options, which can be specified from within the FreeRTOSConfig.h file. To keep commonality with all of the Arduino hardware options, some sensible defaults have been selected.</p>
<p>The AVR Watchdog Timer is used to generate 15ms time slices, but Tasks that finish before their allocated time will hand execution back to the Scheduler. This does not affect the use of any of the normal Timer functions in Arduino.</p>
<p>Time slices can be selected from 15ms up to 500ms. Slower time slicing can allow the Arduino MCU to sleep for longer, without the complexity of a Tickless idle.</p>
<p>Watchdog period options:</p><ul>
<li><code>WDTO_15MS</code></li>
<li><code>WDTO_30MS</code></li>
<li><code>WDTO_60MS</code></li>
<li><code>WDTO_120MS</code></li>
<li><code>WDTO_250MS</code></li>
<li><code>WDTO_500MS</code></li>
<li><code>WDTO_1S</code></li>
<li><code>WDTO_2S</code></li>
</ul>
<p>Note that Timer resolution is affected by integer math division and the time slice selected. Trying to measure 50ms, using a 120ms time slice for example, won't work.</p>
<p>Stack for the <code>loop()</code> function has been set at 192 bytes. This can be configured by adjusting the <code>configMINIMAL_STACK_SIZE</code> parameter. If you have stack overflow issues, just increase it. Users should prefer to allocate larger structures, arrays, or buffers using <code>pvPortMalloc()</code>, rather than defining them locally on the stack.</p>
<p>Memory for the heap is allocated by the normal <code>malloc()</code> function, wrapped by <code>pvPortMalloc()</code>. This option has been selected because it is automatically adjusted to use the capabilities of each device. Other heap allocation schemes are supported by FreeRTOS, and they can used with additional configuration.</p>
<h1>Upgrading</h1>
<ul>
<li><a href="https://www.freertos.org/FreeRTOS-V9.html">Upgrading to FreeRTOS-9</a></li>
<li><a href="https://www.freertos.org/FreeRTOS-V10.html">Upgrading to FreeRTOS-10</a></li>
</ul>
<h1>Errors</h1>
<ul>
<li>Stack Overflow: If any stack (for the <code>loop()</code> or) for any Task overflows, there will be a slow LED blink, with 4 second cycle.</li>
<li>Heap Overflow: If any Task tries to allocate memory and that allocation fails, there will be a fast LED blink, with 100 millisecond cycle.</li>
</ul>
<h1>Errata</h1>
<p>Testing with the Software Serial library shows some incompatibilities at low baud rates (9600), due to the extended time this library disables the global interrupt. Use the hardware USARTs.</p>
<h1>Compatibility</h1>
<ul>
<li>ATmega328 @ 16MHz : Arduino UNO, Arduino Duemilanove, Arduino Diecimila, etc.</li>
<li>ATmega328 @ 16MHz : Adafruit Pro Trinket 5V, Adafruit Metro 328, Adafruit Metro Mini</li>
<li>ATmega328 @ 16MHz : Seeed Studio Stalker</li>
<li>ATmega328 @ 16MHz : Freetronics Eleven</li>
<li>ATmega328 @ 12MHz : Adafruit Pro Trinket 3V</li>
<li>ATmega32u4 @ 16MHz : Arduino Leonardo, Arduino Micro, Arduino Yun, Teensy 2.0</li>
<li>ATmega32u4 @ 8MHz : Adafruit Flora, Bluefruit Micro</li>
<li>ATmega1284p @ 16MHz: Sanguino, WickedDevice WildFire</li>
<li>ATmega1284p @ 24.576MHz : Seeed Studio Goldilocks, Seeed Studio Goldilocks Analogue</li>
<li>ATmega2560 @ 16MHz : Arduino Mega, Arduino ADK</li>
<li>ATmega2560 @ 16MHz : Seeed Studio ADK</li>
</ul>
<p>The new megaAVR 0-Series devices (eg. ATmega4809) are not fully compatible with this library. Their Timer configuration is substantially different from previous devices, and forms part of a new <b>avr8x</b> architecture. It may be a while until avr-libc is updated to include support for megaAVR devices, but when that happens further work will be added here.</p>
<h1>Files &amp; Configuration</h1>
<ul>
<li><code>ATMEGA_FreeRTOS.h</code> : Must always be <code>#include</code> first. It references other configuration files, and sets defaults where necessary.</li>
<li><code>FreeRTOSConfig.h</code> : Contains a multitude of API and environment configurations.</li>
<li><code>FreeRTOSVariant.h</code> : Contains the AVR specific configurations for this port of freeRTOS.</li>
<li><code>heap_3.c</code> : Contains the heap allocation scheme based on <code>malloc()</code>. Other schemes are available, but depend on user configuration for specific MCU choice. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 12 2021 12:25:26 for IoT by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
